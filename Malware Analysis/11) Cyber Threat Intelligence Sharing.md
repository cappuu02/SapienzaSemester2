# Sharing Intelligence
The practice of sharing cyber threat intelligence, vulnerabilities, configurations, best practices, knowledge and tips to a larger external community.

```ad-success
collapse: open
To enhance the cyber security of an individual organization as well as that of the entire sharing community.

```

**_Benefits_**
- **Per le organizzazioni**: ricevono un flusso costante di informazioni aggiornate e personalizzabili in base alla propria infrastruttura, ai sistemi e al software utilizzato.
- **Per la comunit√†**: la condivisione collettiva di esperienze, conoscenze e dati sulle minacce rende la **difesa complessiva pi√π efficace** e reattiva contro nuovi attacchi.

![[MW194.png|600]]
- ü¶† **Un attacco colpisce Company B** ‚Üí ad esempio un malware o una nuova minaccia sconosciuta.
- üî• **Company B segnala l‚Äôincidente** al centro ISAC/CSIRT, condividendo dettagli tecnici (indicatori di compromissione, tattiche, IP, hash, ecc.).
- üõ∞Ô∏è **Il centro ISAC/CSIRT elabora e diffonde l‚Äôinformazione** a tutte le altre aziende della rete (A, C, D, E).
    - Cos√¨ ciascuna azienda pu√≤ aggiornare le proprie difese, patch o regole IDS/IPS in anticipo.
- üõ°Ô∏è **Le altre aziende risultano protette**: ad esempio, **Company C** blocca subito lo stesso attacco che aveva colpito B.

## _Legislative requirements (EU NIS Directive)_
==Direttiva NIS== (Network and Information Security) dell'Unione Europea, il primo quadro normativo europeo sulla cybersecurity. La NIS impone agli stati membri di **adottare misure per migliorare il livello di sicurezza** delle reti e dei sistemi informativi.

**Obiettivi**:
- Rafforzare sicurezza servizi essenziali
- Migliorare la collaborazione tra gli stati membri
- Istituire strutture nazionali:
	- CSIRT (Computer Security Incident Response Team)
	- Autorit√†' nazionali competenti
	- Strategia nazionale NIS


Il diagramma mostra **come funziona la comunicazione e la gestione degli incidenti informatici** prevista dalla **Direttiva NIS** (Network and Information Security Directive).  
Descrive **chi deve notificare gli incidenti** e **come** avviene il flusso di informazioni tra le organizzazioni e le autorit√† competenti.
![[MW195.png]]

**_Parte sinistra_**: Soggetti coinvolti, si suddividono in soggetti richiesti dalla legge e volontari. Tutti devono:
1. Monitorare propri sistemi
2. Difendere i propri sistemi
3. gestire i dati in conformit√† alle norme di privacy (GDPR, Data Protection)

**_Parte Centrale_**: Tutte le segnalazione confluiscono nella Competent Authority o CSIRT nazionale. Il CSIRT riceve informazioni su:
- misure adottate
- rischi di cybersecurity
- incidenti rilevanti
Da qui le informazioni vengono coordinate, analizzate e condivise.

**Parte Destra**: Le **autorit√† e i CSIRT nazionali** comunicano tra loro (CA/CSIRT ‚Üî CA/CSIRT) per scambiarsi informazioni e buone pratiche. Esiste anche un canale pubblico per diffondere allerta e indicazioni di sicurezza.

## Sharing Models
Two main sharing models to share security information:

### Centralized / Hub & Spoke / Subscriber model
The information passes through a central collection center (e.g. ISAC or CSIRT), which receives, analyzes and redistributes the data.

**_Key features_**:
- The center can enrich and analyze data (data enhancement).
- It performs global trend and statistical analyses.
- It applies common sharing rules and agreements.
- It manages data anonymization and cleansing.
- New members have low technical costs to join the system.
- It requires a high level of trust in the central entity.

### Direct / Peer-to-Peer model
Organizations share information directly with each other, without a central intermediary.

**_Key Features_**:
- Faster and more efficient, suitable for immediate exchanges.
- Requires less global trust, only between direct partners.
- Suitable for groups with high operational maturity in cybersecurity.
- Difficult to scale, works best for ad-hoc collaborations.
- Often used by organizations in the same industry with private, targeted partnerships.

## Sharing Technologies

![[MW196.png]]

==Cyber Threat Information Languages==: Sono **formati standardizzati** per descrivere in modo chiaro e comprensibile le informazioni sulle minacce. `STIX`, `IODEF`, `OpenIOC`, `MAEC` sono tutti esempi.

==Cyber Threat Sharing Protocols==: Sono i **canali di comunicazione** usati per scambiare le informazioni tra organizzazioni o piattaforme.
- **TAXII (Trusted Automated eXchange of Indicator Information)** ‚Üí protocollo per trasferire automaticamente dati in formato STIX.
- **RID (Real-time Inter-network Defense)** ‚Üí protocollo per la condivisione in tempo reale di dati sugli incidenti e sulle minacce.

### STIX
==Structured Threat Information Expression== is a language and serialization formati used to exchange cyber threat intelligence (CTI).
- Easy to use
- Widely adopted
- Well-known
- Machine-readable

**_Community-driven_**: `OASIS` (Open standard Consortium)
- vendors, users
-  Government, Private Sector, Academia
-  Open Source

**_Graph-based model_**:
- Information is represented through STIX objects (STIX Domain Objects) and relationships between them.
- This model makes it easier to add, connect, and analyze new data.

**_Tool-agnostic_**
- Version 2.0
- Streamlined, easier to understand
- Uses JSON

![[MW197.png]]

STIX provides a common mechanism for addressing structured cyber threat information across
and among this full range of use cases improving _consistency_, _efficiency_, _interoperability_, and
overall situational awareness.

![[MW198.png]]
1. ==UC1 (Analyzing Cyber Threats)==: rappresenta la fase in cui vengono raccolti e analizzati i dati provenienti da sensori, log e fonti esterne. Il cyber threat analyst studia questi dati per identificare elementi osservabili, il contesto della minaccia e possibili linee d‚Äôazione.
2. ==UC2 (Specifying Indicator Patterns for Cyber Threats)== consiste nel tradurre le informazioni ottenute dall‚Äôanalisi in **_indicatori strutturati di compromissione (IoC)_**, che descrivono comportamenti o segnali riconducibili ad attivit√† malevole e possono essere condivisi o utilizzati in modo automatico nei sistemi di difesa.
3. ==UC3 (Managing Cyber Threat Response Activities)== √® la fase operativa in cui i team di sicurezza (SOC o CERT) utilizzano gli indicatori per **prevenire**, **rilevare** e **rispondere** agli attacchi. Include quindi la pianificazione delle misure difensive, il monitoraggio continuo e la gestione degli incidenti con il supporto dei decisori di sicurezza.
4. ==UC4 (Sharing Cyber Threat Information)== riguarda la **condivisione delle informazioni** ottenute con altri reparti interni o con comunit√† esterne di sicurezza, come ISAC o CSIRT. Questa condivisione segue politiche precise su cosa diffondere e con chi, con l‚Äôobiettivo di migliorare la cooperazione e la protezione collettiva contro le minacce informatiche.


STIX defines 12 Domain Objects (SDOs) in its data model:
![[MW199.png]]
![[MW200.png]]
![[MW201.png]]

Furthermore it defines $2$ Relationship Objects (SROs)
![[MW202.png]]

#### Overall model
==Diagramma STIX==, linguaggio standard per descrivere e collegare tra loro le informazioni sulle minacce informatiche (Cyber Threat Intelligence). Ogni riquadro rappresenta un gruppo di **STIX Domain Objects (SDOs)**, cio√® entit√† che descrivono attori, tattiche, tecniche, strumenti, osservazioni e contromisure.
![[MW203.png]]

üî¥ **Adversaries ‚Äì gli attaccanti**
Il riquadro ‚ÄúAdversaries‚Äù rappresenta **chi conduce l‚Äôattacco**.
Ci sono tre tipi principali di oggetti:
- **Threat Actor:** l‚Äôattore della minaccia, cio√® l‚Äôindividuo, il gruppo o l‚Äôorganizzazione responsabile dell‚Äôattacco.
- **Intrusion Set:** un insieme di attivit√† o attacchi attribuiti a uno stesso gruppo o con tattiche simili.
- **Campaign:** una singola campagna offensiva o operazione specifica condotta dal gruppo.  
    Le frecce ‚Äú**attributed-to**‚Äù collegano questi elementi per indicare _chi √® responsabile di cosa_ (es. una campagna √® attribuita a un gruppo APT).

üîµ **TTPs ‚Äì Tactics, Techniques, and Procedures**
Nel riquadro a sinistra, ‚ÄúTTPs‚Äù rappresenta **come l‚Äôattacco viene eseguito**.
Include:
- **Attack Pattern:** le tecniche usate, come spear-phishing, exploit di vulnerabilit√†, ecc.
- **Malware:** software malevoli impiegati negli attacchi.
- **Tool:** strumenti legittimi o offensivi usati dagli attaccanti (es. PowerShell, Mimikatz).  
    Le relazioni ‚Äú**uses**‚Äù collegano questi oggetti: un attore della minaccia _usa_ un determinato malware o strumento per eseguire una tecnica.

üü£ **Observed Data e Sightings ‚Äì le evidenze**
La parte centrale con ‚ÄúObserved Data‚Äù e ‚ÄúSightings‚Äù rappresenta le **osservazioni concrete** raccolte sul campo:
- **Observed Data:** dati grezzi rilevati (log, pacchetti, eventi, file sospetti).
- **Sighting:** conferma che un certo indicatore o attacco √® stato effettivamente visto in un sistema. 
    Le frecce ‚Äú**sighting_of_ref**‚Äù e ‚Äú**observed_data_refs**‚Äù collegano queste prove ai rispettivi indicatori o minacce.

üü¢ **Course of Action e Vulnerability ‚Äì la difesa**
In basso, troviamo:
- **Vulnerability:** debolezze sfruttabili (es. CVE).
- **Course of Action:** contromisure e azioni correttive (es. patch, regole firewall, policy).  
    La relazione ‚Äú**mitigates**‚Äù mostra come un‚Äôazione possa ridurre il rischio di una vulnerabilit√† o bloccare una tecnica di attacco.

üë§ Infine, l‚Äôoggetto **Identity** rappresenta le persone, organizzazioni o infrastrutture coinvolte:
- pu√≤ essere la **vittima** di un attacco (relazione ‚Äútargets‚Äù),
- oppure un‚Äôentit√† **impersonata** o falsificata (‚Äúimpersonates‚Äù).

```ad-info
title: Processo Unico
Gli **attaccanti (Adversaries)** eseguono **campagne** che impiegano **malware o strumenti (TTPs)** per colpire **vittime (Identity)** o sfruttare **vulnerabilit√†**.

Gli analisti **osservano i dati (Observed Data)** e li collegano agli **indicatori di compromissione**, generando **sightings** e analisi di contesto.

Le informazioni cos√¨ strutturate permettono di **condividere in formato STIX** tutti i legami tra attori, tecniche, vulnerabilit√† e contromisure.

**Chi** attacca ‚Üí **Come** attacca ‚Üí **Cosa** usa ‚Üí **Chi/che cosa** colpisce ‚Üí **Come** difendersi.

```



So, Allow to focus analysis on specific elements, e.g.:
```ad-example
![[MW204.png]]

L‚Äôoggetto ‚ÄúMalware‚Äù √® il nodo principale. Le sue connessioni aiutano gli analisti a comprendere:
- la **provenienza** del malware, 
- le **tecniche di attacco** che impiega,
- le **vittime o vulnerabilit√†** sfruttate,
- le **difese** che lo contrastano.
  
Questo modello permette di **focalizzare l‚Äôanalisi su un singolo malware**, ma allo stesso tempo di ricostruire **tutto il contesto operativo** che lo circonda: chi lo usa, come agisce, quali vulnerabilit√† sfrutta e come difendersi.

```

```ad-example
title: Example: Indicator with Relationships
![[MW205.png]]

```

```ad-example
title: Example: Threat Actor with Relationships
![[MW206.png]]

```

```ad-example
title: Example: Campaign with Relationships
![[MW207.png]]

```

#### STIX, Representation
STIX 2 objects are represented in `JSON`.
![[MW208.png]]

>Gli oggetti STIX 2.0 sono strutturati in **JSON** per garantire compatibilit√†, leggibilit√† e facilit√† di scambio automatico tra piattaforme di Cyber Threat Intelligence. Questo formato permette di **mantenere versioni**, **descrivere in modo preciso un IoC** e **collegarlo ad altri elementi della minaccia**.

Tutti gli oggetti STIX 2.0 (come _Indicator_, _Malware_, _Campaign_, ecc.) condividono un insieme di ==propriet√† comuni==, necessarie per garantire funzionalit√† fondamentali come **l‚Äôidentificazione**, **il versioning** e **la tracciabilit√†**.

La specifica STIX 2.0 definisce quindi un set di campi standard che ogni oggetto deve o pu√≤ includere. Propriet√† Comuni:
- **type** ‚Üí indica il tipo di oggetto (es. ‚Äúindicator‚Äù, ‚Äúmalware‚Äù).
- **id** ‚Üí identificatore univoco dell‚Äôoggetto (UUID).
- **spec_version** ‚Üí versione dello standard STIX usata (es. ‚Äú2.0‚Äù).
- **created_by_ref** ‚Üí riferimento all‚Äôidentit√† (persona/ente) che ha creato l‚Äôoggetto.
- **created** ‚Üí data di creazione.
- **modified** ‚Üí data dell‚Äôultima modifica.
- **revoked** ‚Üí indica se l‚Äôoggetto √® stato revocato (es. perch√© non pi√π valido).
- **labels** ‚Üí parole chiave o categorie per classificare l‚Äôoggetto (es. ‚Äúmalicious-activity‚Äù).
- **external_references** ‚Üí link o fonti esterne che forniscono informazioni aggiuntive.
- **object_marking_refs** ‚Üí riferimenti ai _marking definitions_ (per gestire restrizioni o livelli di confidenzialit√†).
- **granular_markings** ‚Üí marcature pi√π specifiche, applicate solo a certe parti dell‚Äôoggetto (es. a un singolo campo).

In STIX 2.0, ogni oggetto deve avere un identificatore univoco, contenuto nella propriet√† `id`. Questo identificatore serve a **riconoscere in modo universale** l‚Äôoggetto in qualsiasi contesto di condivisione o analisi.

```ad-example
 `indicator--8e2e2d2b-17d4-4cbf-938f-98ee46b3bd3f`

```

Le propriet√† che finiscono con `_ref` (come `created_by_ref`, `sighting_of_ref`, `object_marking_refs`, ecc.) sono riferimenti ad altri oggetti STIX.
- Servono per collegare tra loro diversi oggetti all‚Äôinterno dello stesso dataset.
- Ogni riferimento punta all‚ÄôID dell‚Äôaltro oggetto.
- Un riferimento pu√≤ puntare a un oggetto **non ancora presente** nel dataset del consumatore.

![[MW209.png]]

**_Create STIX 2.0 Object_**:
There are two major steps to creating a valid STIX 2.0 Object:
1. Populate all required common properties of the Object
2. Populate all required Object-specific properties

![[MW210.png]]

ogni ==STIX Domain Object (SDO)==, come _Indicator_, _Malware_, _Threat Actor_, _Campaign_, ecc., ha un proprio **insieme di tipi di relazioni** predefiniti, che servono a descrivere come quell‚Äôoggetto interagisce con gli altri.

![[MW211.png]]

> **Indicator ‚Üí indicates ‚Üí Malware**, significa che l‚Äôindicatore osservato √® una prova o traccia che _indica_ un certo malware o attacco.

In addition, STIX defines several relationships that are common to all Objects:
- **_derived-from_**: the information in the target object is based on information from the source object.
- **_duplicate-of_**: the referenced source and target objects are semantically duplicates of each other.
- **_related-to_**: the referenced source and target objects are arbitrarily related to each other.

#### STIX, Versioning
**Objects** may have ==new versions== defined only by their **Object Creator**.

- **_Object Creator_**: the entity (e.g., system, organization, instance of a tool) that generates the id property for a given object. 
	- _Object creators are represented as Identity objects_.
- Producers other than the Object Creator are not allowed to create new versions of an Object, and instead must create a new Object (with a new id) 

**_Reasons for versioning an existing Object_**:
- Updating existing information
- Adding new information
- Removing information 

Objects may also **be revoked** by setting the revoked property to true
- This is permanent ‚Äì once an Object has been marked as revoked, future versions MUST NOT be created


The ==version of an Object== is based on the value of its `id` and `modified properties`
- `id`: immutable ‚Äì must not be changed after creation
- modified: mutable ‚Äì represents the time that this particular version of an Object was last modified
For the first version of an Object, the created and modified timestamps MUST have the
same value

![[MW212.png]]

It‚Äôs up to the Object Producer to determine when to update an existing object versus
creating a new object. However, it is recommend that anytime an update constitutes a material change (a change in the fundamental meaning of an object), a new object with a different id should be used.

One of the key benefits of STIX 2.0 versioning and relationships is that it allows multiple users to reference STIX Objects without necessitating a new version of the object.

![[MW213.png]]

#### STIX, Data Markings
L‚Äôoggetto **`marking-definition`** serve per **definire regole di gestione, condivisione o riservatezza** applicate ai dati di Cyber Threat Intelligence (CTI). In pratica, specifica **come e con chi** un‚Äôinformazione pu√≤ essere condivisa.

Le marking-definition vengono applicate ad altri oggetti STIX tramite due propriet√†:
- **`object_marking_refs`** ‚Üí si usa per applicare un livello di marcatura all‚Äôintero oggetto (es. ‚ÄúTLP:AMBER‚Äù).
- **`granular_markings`** ‚Üí si usa per applicare marcature solo a parti specifiche di un oggetto (es. un singolo campo).

Entrambe queste propriet√† contengono una lista di **ID che puntano a oggetti di tipo `marking-definition`**.

```ad-attention
Le **marking-definition non possono essere versionate**!
Questo perch√©, se fosse possibile modificarle nel tempo, si potrebbero **alterare retroattivamente** le regole di condivisione applicate ad altri oggetti, generando **ambiguit√† e rischi di sicurezza**.

```


- **Object markings** ‚Üí si applicano **all‚Äôintero oggetto STIX**.  
    Esempio: un malware contrassegnato come ‚ÄúTLP:AMBER‚Äù indica che _tutte le informazioni sull‚Äôoggetto sono condivisibili solo con partner fidati_.
- **Granular markings** ‚Üí si applicano **a singole propriet√†** di un oggetto.  
    Esempio: la propriet√† `name` pu√≤ essere pubblica (TLP:WHITE), mentre `description` pu√≤ essere riservata (TLP:RED).
    

>In questo modo si ottiene **maggiore controllo** sul livello di visibilit√† dei dati condivisi.

- **Statement markings** ‚Üí marcature testuali personalizzate, come avvisi legali o copyright.  
    Esempio: ‚Äú¬© 2025 Company X ‚Äì Confidential Information‚Äù.
- **TLP (Traffic Light Protocol)** ‚Üí sistema standardizzato di marcature definite nella specifica STIX, con quattro livelli di condivisione:
    - üî¥ **TLP:RED** ‚Äì informazioni strettamente confidenziali (solo destinatari diretti).
    - üü† **TLP:AMBER** ‚Äì condivisibili solo all‚Äôinterno dell‚Äôorganizzazione o con partner fidati.
    - üü¢ **TLP:GREEN** ‚Äì condivisibili all‚Äôinterno della comunit√†.
    - ‚ö™ **TLP:WHITE** ‚Äì informazioni pubbliche.

Le data markings non hanno relazioni dirette (`SRO`) con altri oggetti STIX.  
Invece, vengono **referenziate tramite la propriet√† comune `object_marking_refs`**, che permette a ogni oggetto STIX di:
- indicare **quali marcature** gli sono associate,
- e garantire che queste marcature **siano applicate correttamente** senza ambiguit√†.

![[MW214.png]]

```ad-example
![[MW215.png]]

```

#### STIX - Patterns
```ad-seealso
title: Definition
==STIX Patterning== √® un **linguaggio standard** introdotto in **STIX 2.0** per **descrivere ci√≤ che si vuole rilevare** in un ambiente informatico, cio√® _come riconoscere un comportamento o un artefatto malevolo_.

```

>√à ci√≤ che permette di dire: "`Cerca un file con questo hash MD5 e che stabilisce una connessione a questo dominio.`"

- In STIX 1.x, il patterning era parte integrante dell‚Äôoggetto _Observable_ (cio√® di ci√≤ che si osservava).
- In **STIX 2.0**, √® diventato un **linguaggio autonomo**, con **una propria grammatica**, usato principalmente dentro l‚Äôoggetto **Indicator**.  
	- Questo lo rende pi√π flessibile, potente e leggibile anche dalle macchine.

STIX Patterning pu√≤ descrivere **sia dati host-based** che **network-based** nello stesso linguaggio.

```ad-example
Un malware con firma X comunica in rete con traffico simile a Y, prima di scaricare il file Z.‚Äù  
Questa relazione complessa non pu√≤ essere espressa facilmente in YARA o Snort, ma si pu√≤ rappresentare in STIX Patterning.

```


Un pattern STIX 2.0 ha una sintassi simile a una condizione logica, ad esempio:
![[MW216.png]]
**_Analisi dell'esempio_**:
Ogni blocco tra parentesi quadre `[...]` rappresenta un‚Äô**espressione di osservazione**, cio√® un evento osservabile.  
In questo caso ci sono due:
- `[ipv4-addr.value = 'x' OR ipv4-addr.value = 'y']`
- `[domain-name.value = 'z']`
Queste indicano rispettivamente:
- un indirizzo IP uguale a _x_ o _y_,
- un dominio uguale a _z_.

- Gli **SCO (STIX Cyber Observables)** descrivono **ci√≤ che hai effettivamente osservato** ‚Äî sono i ‚Äú**sostantivi**‚Äù (es. file, processo, connessione, dominio).
- Lo **STIX Patterning** √® invece **il linguaggio** usato per **descrivere le condizioni** che identificano comportamenti sospetti usando quegli stessi oggetti.

```ad-example
Finding an IP
`[ip-addr.value = '8.8.8.8']`

Finding a URL
`[url:value MATCHES`
`‚Äò^(?:https?:\/\/)?(?:www\.)?example\.com\/.*‚Äô]`

Finding one of two registry keys
`[windows-registry-key:key = 'HKEY_CURRENT_USER \\Software\`
`\CryptoLocker\\Files' OR windows-registry-key:key =`
`‚ÄòHKEY_CURRENT_USER\\Software\\Microsoft\\CurrentVersion\`
`\Run\\\CryptoLocker_0388']`

```

```ad-example
Looks for a particular malware payload followed by HTTP beaconing traffic
generated by the payload (Necurs Botnet):

![[MW217.png]]

```

anche se STIX permette di descrivere indicatori in modo standard, molti strumenti (come firewall, IDS o proxy) non ‚Äúparlano STIX‚Äù direttamente, quindi serve convertirli o spezzarli in sotto-pattern compatibili.

cerca qualsiasi URL che appartenga al dominio `example.com`.
![[MW218.png]]

```ad-info
title: Spiegazione
Il pattern viene inviato a un **TIG (Threat Intelligence Gateway)** ‚Äî in questo caso un **BlueCoat** ‚Äî che controlla il traffico web in uscita.  
Se il gateway **non supporta STIX Patterning nativamente**, il pattern deve essere **convertito nella sintassi di query nativa** del dispositivo (ad esempio, in una regola proxy o filtro URL interno).

üëâ In sostanza: **STIX ‚Üí linguaggio specifico del prodotto** (perch√© ogni vendor ha le sue regole di detection).

```


With security tools that have limited visibility on certain observable types, the Pattern may need to be split into subsets prior to evaluation.

cerca un file con quell‚Äôhash specifico che, una volta eseguito, effettua una richiesta HTTP POST con header `User-Agent: Windows-Update-Agent`.
![[MW219.png]]

With security tools like a SIEM, all of the observable types may be available to evaluate a complex pattern within a single context.

![[MW220.png]]

```ad-example
Adversary Bravo is known to use phishing attacks to deliver remote access
malware to the targets. The malware variety they typically use is a variant on
the Poison Ivy malware.
‚ñ™ Any known characteristics and attributes of Adversary Bravo can be modeled using the
Threat Actor SDO
‚ñ™ Specify required properties for the Threat Actor object which consist of a name and a list of labels
‚ñ™ The labels field categorizes the type of threat actor based on the open vocabulary threat-actor-label-ov
‚ñ™ Adversary Bravo may be performing nefarious activity or spying which results in labels of criminal and spy.
‚ñ™ Other basic identifying information about Adversary Bravo is captured with an Identity
SDO
‚ñ™ There is little information about this identity, so the required identity_class property, based on the identity-class-
ov, would be unknown
‚ñ™ The Identity SDO can be linked with the Threat Actor SDO by using a Relationship object.
‚ñ™ The type of relationship between the 2 objects, represented by the relationship_type field, would contain a
value of attributed-to

```

```ad-example
The malware in this scenario is a Poison Ivy variant d1c6 which
can be represented using a Malware SDO
‚ñ™ It is required for every Malware object to incorporate a list of labels to describe
the malware
‚ñ™ the labels property would contain the value remote-access-trojan which comes
from the malware-label-ov
‚ñ™ Another relationship can be established between this Malware SDO and the
Threat Actor SDO. In this case, the relationship_type between the two
objects would be uses.

```

```ad-example
Adversary Bravo uses phishing as a delivery mechanism for the
Poison Ivy malware which can be represented using an Attack
Pattern SDO
‚ñ™ Attack Pattern objects are useful for representing taxonomies such as CAPEC
with the external_references field
‚ñ™ CAPEC is a dictionary of potential attack patterns, so in this case by looking in that dictionary the
producer could see that ‚ÄúCAPEC-98‚Äù is the ID for phishing and can label the external_id as such
‚ñ™ A Relationship SRO once again links the Threat Actor to this Attack Pattern
object with a relationship_type of uses.

```

```ad-example
One other useful concept that is seen in both the Malware and
Attack Pattern objects is the ability to capture kill chain information
‚ñ™ In this example, the Poison Ivy malware and phishing attack pattern are
associated with the kill chain phase initial-compromise

![[MW218.png]]

```

### TAXII
```ad-seealso
title: Definition
==TAXII (Trusted Automated Exchange of Intelligence Information)== is a protocol used to share **Cyber Threat Intelligence (CTI)** securely over **HTTPS**.

```

It is designed to make the exchange of CTI ‚Äî especially in **STIX** format ‚Äî simple and standardized. TAXII is **open source** and available in multiple programming languages.

TAXII defines a **RESTful API** that specifies how **clients** and **servers** communicate through services and message exchanges.

- It uses **HTTPS (TLS 1.2 or higher)** for secure communication.
- It uses **JSON** as the common data format for interoperability.

TAXII supports two main services:
1. **Collection Service** ‚Äì a TAXII Server hosts a repository (collection) of CTI objects that producers can share and consumers can request.
2. **Request-Response Model** ‚Äì TAXII Clients and Servers exchange information through standard API requests and responses.

![[MW222.png]]

**TAXII** also defines a second type of service called a **Channel**, which supports a **publish-subscribe** sharing model.

A **Channel** is managed by a **TAXII Server** and allows:
- **Producers** to push CTI data to multiple consumers.
- **Consumers** to receive data from multiple producers.

In this model, **TAXII Clients** exchange information with each other through the server, enabling **real-time, many-to-many communication** instead of the simple request-response model.

![[MW223.png]]

Models can be mixed to allow interoperability among TAXII servers in separate trust boundaries:
![[MW224.png]]

Complex CTI sharing scenarios are enabled:
![[MW225.png]]

1. Un **analista approvato** invia un nuovo **indicatore di minaccia (Indicator)** all‚ÄôISAC tramite il **TAXII Indicator Channel**.
2. L‚Äô**ISAC** (che funge da **TAXII Server**) distribuisce automaticamente l‚Äôindicatore a **tutti i membri iscritti a quel canale**, ad esempio **Member 1** e **Member 2**.
    - Member 1 riceve l‚Äôindicatore perch√© √® iscritto al canale _Indicator_.
3. **Member 2** rileva un‚Äôattivit√† correlata (una _sighting_, cio√® un avvistamento del malware o dell‚Äôindicatore) e la invia all‚ÄôISAC tramite il **Sighting Channel**.
4. L‚Äô**ISAC** condivide questa _sighting_ con tutti i membri iscritti a quel canale (incluso l‚Äôanalista o altri membri).
5. **Member 2** aggiunge nuove informazioni (un _data enrichment_, cio√® un arricchimento dell‚Äôindicatore) e le invia all‚ÄôISAC tramite il **Enrichment Channel**.
6. L‚Äô**ISAC** redistribuisce l‚Äôenrichment a **tutti gli iscritti a quel canale**, mantenendo la condivisione sincronizzata tra analisti e membri.

**TAXII enables complex Cyber Threat Intelligence (CTI) sharing scenarios**, allowing information to move securely and efficiently between different entities and levels of trust.

It supports:
- **Internal communication** between devices within the same organization.
- **Analyst-to-analyst collaboration** inside the same network, enabling coordinated investigation and response.
- **Organization-to-organization sharing**, where CTI or indicators are published to trusted partners or communities.
- **Analyst-to-external workgroup sharing**, allowing analysts to exchange intelligence within specific circles of trust or interest groups.

#### TAXII, API Endpoints
![[MW226.png]]

Server Discovery: Get server information and a list of API Roots

```bash
Request: GET https://ts01.example.com/taxii2/
Response:
{
"title": "Some TAXII Server",
"description": "This TAXII Server contains a listing of...",
"contact": "string containing contact information",
"default": "https://example.com/api2/",
"api_roots": [
"https://example.com/api1/",
"https://example.com/api2/",
"https://example.net/trustgroup1/"
] }
```

Get information about an API Root:

```bash
Request: GET https://ts01.example.com/api1/
Response:
{
"title": "Malware Research Group",
"description": "A trust group setup for malware researchers",
"versions": [
"application/taxii+json;version=2.1‚Äù
],
"max_content_length": 104857600
}
```

Get a list of available collections
```bash
Request: GET https://ts01.example.com/api1/collections
Response:
{
"collections": [
<list of collection resources>
]
}
```


Get details about a specific collection

```bash
Request: GET https://ts01.example.com/api1/collections/
91a7b528-80eb-42ed-a74d-c6fbd5a26116/
Response:
{
"id": "91a7b528-80eb-42ed-a74d-c6fbd5a26116",
"title": "High Value Indicator Collection",
"description": "This data collection contains high value IOCs",
"can_read": true,
"can_write": false,
"media_types": [
"application/stix+json;version=2.1‚Äù
]
}
```

Get summary info (manifest) about a collection
![[MW227.png]]

GET Objects from a collection
![[MW228.png]]

GET Object by ID
```bash
Request: GET https://ts01.example.com/api1/collections/91a7b528-80eb-42
ed-a74d-c6fbd5a26116/objects/indicator--252c7c11-daf2-42bd -843b-
be65edca9f61/
Response:
{
"type": "bundle",
...
"objects": [
{
"type": "indicator",
"id": "indicator--252c7c11-daf2-42bd-843b-be65edca9f61",
...
} ]
}
```

Posting Data to a Collection - POST
```bash
Request: POST https://ts01.example.com/api1/collections/91a7b528-80eb-42 ed-a74d-
c6fbd5a26116/objects/
Content:
{
"objects": [
{
	"type": "indicator",
	"id": "indicator--12fd1bad-8306-4ed4-8c9b-7dfdd8ad5eb8",
	"name": "Bad IP1",
	"description": "STIX/TAXII 2.0 Interoperability Part 1, ¬ß2.2.3.1,
	Indicator IPv4 Address",
	"created": "2018-01-17T11:11:13.000Z",
	"modified": "2018-01-17T11:11:13.000Z",
	"valid_from": "2018-01-01T00:00:00.000Z",
	"labels": ["malicious-activity"],
	"pattern": "[ipv4-addr:value = '198.51.100.1']"
	} ]
}
```

Posting Data to a Collection - POST
```
Request: POST https://ts01.example.com/api1/collections/
91a7b528-80eb-42 ed-a74d-c6fbd5a26116/objects/
Response:
{
	"id": "2d086da7-4bdc-4f91-900e-d77486753710",
	"status": "complete",
	"request_timestamp": "2016-11-02T12:34:34.12345Z",
	"total_count": 1,
	"success_count": 1,
	"successes": [
	"List of objects defined in the Part1 bundle test cases"
	],
	"failure_count": 0,
	"pending_count": 0
}
```

## TAXONOMIES
Le tassonomie aiutano a strutturare e descrivere in modo coerente diversi aspetti di una minaccia informatica, come:
- **Attacker motivation** ‚Üí perch√© l‚Äôattaccante agisce (es. profitto, spionaggio, sabotaggio).
- **Attacker behavior (TTP)** ‚Üí tecniche, tattiche e procedure usate.
- **Attacker capability** ‚Üí livello di competenza o risorse a disposizione.
- **Targeted attack surface** ‚Üí cosa viene colpito (es. server, utenti, reti).
- **Potential impact** ‚Üí i possibili effetti dell‚Äôattacco.
- **How to detect threat** ‚Üí come individuare la minaccia.
- **How to mitigate threat** ‚Üí come prevenirla o ridurne l‚Äôimpatto.

## What are Attack Patterns?
Attack patterns are **blueprints** that describe how a specific type of attack is typically carried out.  
They represent **common techniques and methods** abstracted from known exploits and capture the **attacker‚Äôs perspective**, helping developers, acquirers, and operators strengthen the security and assurance of their systems.

## Leveraging Attack Patterns in the SDLC
Attack patterns can be used throughout the **Software Development Life Cycle (SDLC)** to improve security:

- Guide the **definition of security policies**.  
- Support the **creation of precise security requirements** (both positive and negative).  
- Provide **context for architectural risk analysis**.  
- Enable **risk-driven secure code reviews**.  
- Help define **focused security testing**.  
- Identify and describe **attacker TTPs** for red teaming.  
- Act as a **bridge between secure development and secure operations**.  
- Support **attack detection and characterization** during operations by recognizing malicious behavior patterns.


## Bridge SECDEV and SECOPS
![[MW229.png]]

### SECOPS Knowledge and its Value to SECDEV

Attack patterns create a bridge between **secure operations (SecOps)** and **secure development (SecDev)**.  
By leveraging operational insights, developers can better understand which attacks occur most frequently and how successful they are in real-world environments.  
This knowledge helps them identify and prioritize the most relevant attack patterns, focus on critical weaknesses to avoid, and recognize new or evolving attack variations.

From the opposite perspective, SecOps teams also benefit from SecDev‚Äôs structured understanding of attack patterns.  
These patterns help them interpret and contextualize the large volumes of security data they analyze daily, guiding decisions and improving incident detection and response.
## Common Attack Pattern Enumeration and Classification (CAPEC)

**CAPEC** is a community-driven initiative that standardizes the way attack patterns are described and shared.  
It integrates known attack patterns into a single, structured framework that reflects the **attacker‚Äôs point of view**, supporting both development and operational security efforts.

CAPEC is a valuable resource for:
- Developing **abuse cases** and analyzing **architectural attack resistance**.  
- Conducting **risk-based penetration tests** and **red team exercises**.  
- Correlating **white-box and black-box testing** results.  
- Enhancing **operational monitoring and incident correlation**.

Today, CAPEC is maintained by **MITRE** and publicly available at [capec.mitre.org](http://capec.)

## What attack patterns look like
Attack patterns are structured artifacts made of **primary** and **supporting** schema elements that describe, contextualize and prescribe responses to a class of attacks.
### Primary elements
**Identifying information:** attack pattern ID and name.  
**Describing information:** short description, related weaknesses and vulnerabilities, method of attack, concrete examples and references.  
**Prescribing information:** solutions and mitigations (what to do).  
**Scoping information:** typical severity and likelihood of exploit, prerequisites, required attacker skill/resources, and attacker motivation/consequences.  
**Context:** additional notes that delimit when and where the pattern applies.

### Supporting elements
**Detailed descriptors:** injection vector, payload, activation zone and payload impact.  
**Diagnostics:** probing techniques, indicators/warnings, and obfuscation methods.  
**Relationships and guidance:** related attack patterns, relevant security requirements, design patterns and security patterns.

## Capec current Content
### By domain  
**Software** ‚Äî attacks that target application logic, libraries or OS services.  
**Hardware** ‚Äî exploits of device firmware, chips or physical components.  
**Communications** ‚Äî attacks on network protocols, links or message flows.  
**Supply Chain** ‚Äî compromises introduced through third-party components, services or manufacturing.  
**Social Engineering** ‚Äî human-targeted manipulations (phishing, pretexting, etc.).  
**Physical Security** ‚Äî attacks that exploit physical access or environmental vulnerabilities.

### By mechanism  
**Engage in deceptive interactions** ‚Äî trick users or systems into revealing data or taking actions.  
**Abuse existing functionality** ‚Äî use legitimate features in unintended ways to achieve compromise.  
**Manipulate data structures** ‚Äî corrupt or craft data (e.g., metadata, memory structures) to alter behavior.  
**Manipulate system resources** ‚Äî exhaust or hijack CPU, memory, I/O or other resources.  
**Inject unexpected items** ‚Äî introduce malformed inputs, files, or code (e.g., SQL injection, file drops).  
**Employ probabilistic techniques** ‚Äî use randomness or statistical methods to evade detection or guessing defenses.  
**Manipulate timing and state** ‚Äî exploit race conditions, time windows or inconsistent state.  
**Collect and analyze information** ‚Äî reconnaissance and data aggregation to inform attacks.  
**Subvert access control** ‚Äî bypass or escalate privileges, weaken authentication/authorization.

## MITRE ATT&CK ‚Äî Overview

**MITRE ATT&CK‚Ñ¢** is an open, global knowledge base of **adversary tactics and techniques** built from real-world observations. It describes *what attackers do* (behaviors and goals) rather than *which tools* they use, with strong focus on post-compromise activity.

![[MW230.png]]

**Key characteristics**
- Threat-data‚Äìdriven: techniques are grounded in observed incidents.  
- High fidelity for post-exploit stages (lateral movement, persistence, exfiltration, etc.).  
- Describes attacker **behavior** independently of specific malware or tools.

**Core components**
- A set of **tactics** (phases of the attack lifecycle) that represent attacker goals.  
- For each tactic, a catalog of **techniques** (and sub-techniques) that adversaries use to achieve that goal.  
- For many techniques, **recommended detection approaches and mitigations**.  
- **Documented examples** showing real adversaries using the techniques.

**Limitations of public ATT&CK data**
Publicly available intel can be useful but also has gaps: it is sometimes **not granular enough** and the **volume of examples may be insufficient** for precise risk modeling or automated detection tuning.

```ad-warning
title: CAPEC VS. ATT&CK
**CAPEC** focuses on **application security** and documents how adversaries exploit known software or system weaknesses.  
It provides a structured catalog of attack patterns that describe *how* an exploit works from the attacker‚Äôs perspective.

**Key characteristics:**
- Focused on **application-level vulnerabilities and exploits**.  
- Enumerates common attack patterns against **vulnerable systems**.  
- Includes **social engineering** and **supply chain** attacks.  
- Closely associated with the **Common Weakness Enumeration (CWE)** framework.

**MITRE ATT&CK‚Ñ¢** centers on **network defense** and models the **operational phases** of an attacker‚Äôs lifecycle‚Äîboth **pre- and post-exploitation**.  
It describes the **tactics, techniques, and procedures (TTPs)** used by advanced persistent threats (APT) to compromise and operate within target environments.

**Key characteristics:**
- Focused on **network and endpoint defense**.  
- Based on **threat intelligence** and **red team research**.  
- Provides a **contextual view of adversary behavior** across all attack phases.  
- Supports **testing, detection engineering, and defense evaluation**.

```

## MAEC
**MAEC** is a standardized language for **sharing structured information about malware**.  
It provides a consistent way to describe malware‚Äôs **attributes, behaviors, and relationships**, allowing analysts and tools to exchange data seamlessly.

**_Key components_**
- **Grammar (Schema):** defines how malware information is structured.  
- **Vocabulary (Enumerations):** provides standardized terms for describing malware features and actions.  
- **Collection Format (Bundle):** groups related malware instances and behaviors into a unified data package.

**_Purpose_**
MAEC focuses on **malware attributes and behaviors** rather than just indicators or signatures.  
It enables **correlation, integration, and automation** across different analysis tools and intelligence platforms, improving detection, classification, and response efficiency.

![[MW231.png]]

### MAEC USE CASES
![[MW232.png]]

==Malware Analysis  ==
MAEC supports both **static** and **dynamic analysis** by providing a structured format to describe malware behaviors and attributes.  
It facilitates **malware visualization**, **standardized tool output**, and the creation of **analysis-oriented repositories**, making it easier to share and compare results across tools and analysts.

==Cyber Threat Intelligence  ==
MAEC contributes to **threat scoring**, **attribution**, and **malware provenance** (tracing origin and evolution).  
By standardizing how malware information is represented, it enables consistent correlation between CTI platforms and analytical systems.

==Incident Management  ==
MAEC provides a **uniform reporting format** for malware-related incidents, improving consistency in documentation, **remediation efforts**, and **repository management** across organizations.

### MEAC Contents

- **Top-level Objects (TLOs):** main entities at the highest level of a MAEC package, such as *Malware Instance* and *Behavior* objects.  
- **MAEC Types:** reusable data structures used within TLOs to describe specific details.  
- **Relationships:** logical links defined between pairs of TLOs (e.g., a behavior related to a malware instance).  
- **Package:** MAEC‚Äôs **standard output format**, used to bundle related data for sharing.  
- **Common Data Types:** shared elements and formats used across MAEC objects to ensure consistency.  
- **Cyber Observable Object Extensions:** MAEC-specific extensions to **STIX Cyber Observables**, allowing deeper behavioral representation.  
- **Vocabularies:** standardized terminologies used to define properties and attributes across MAEC objects.

### MAEC Overview
![[MW233.png]]

### MAEC TOP-LEVEL OBJECTS
A **Behavior** represents the **intended purpose or function** of a specific piece of malware code during execution.  
It describes *what the malware is trying to achieve*, rather than the low-level actions it performs.  

**Examples:**  
- Capturing keystrokes (keylogging)  
- Detecting if the malware is running in a virtual machine  
- Installing a backdoor for remote access  

A Behavior can be composed of one or more **Malware Actions**, which provide additional technical detail and context about how that behavior is carried out.

A **Collection** is a grouping of related **MAEC entities** ‚Äî such as *Malware Instances*, *Behaviors*, or *STIX Cyber Observables* ‚Äî that are connected by some form of relationship or shared context.  

It is used to **organize and associate related information**, enabling analysts to manage and analyze malware data more effectively.

#### Malware Action
A **Malware Action** represents a **low-level system operation** performed by a malware instance during execution ‚Äî typically corresponding to a **system API call** or similar event.  
It reflects *what the malware does* at the system level, without explaining *why* the action was performed.

**Key points:**
- It is the **lowest-level dynamic operation** within a malware‚Äôs behavior.  
- **No contextual meaning** is included ‚Äî that is provided by higher-level **Behavior** objects.  
- **Examples:** creating or modifying a file on disk, opening a network port, or writing to the Windows Registry.  
- These actions are often **detected and logged** by **dynamic malware analysis tools** (e.g., sandboxes).

In summary, Malware Actions form the **building blocks** of Behaviors, offering a granular view of the technical steps a malware takes during execution.

```ad-example
![[MW234.png]]

```

==Malware Family==
A **Malware Family** is a group of **related malware instances** that share common authorship, codebase, or evolutionary lineage.  
Members of the same family typically exhibit **similar structures, behaviors, or embedded components** (such as shared code fragments or strings).  
Families are often given specific names (e.g., *Emotet*, *Zeus*, *LockBit*) to identify them in threat intelligence and research.


==Malware Instance==
A **Malware Instance** represents a **single sample** or **variant** within a malware family, usually distributed as a **binary file**.  
It allows for detailed characterization of:
- The **binary‚Äôs properties and structure**,  
- The **behaviors, capabilities, and actions** it performs,  
- **Analyses** and findings associated with that sample, and  
- **Relationships** with other malware instances (e.g., shared code, similar behavior).  

In essence, the **Malware Family** defines the broader lineage, while the **Malware Instance** captures the specific executable or sample used in analysis.

```ad-example
![[MW235.png]]

```

#### MAEC TYPES
Define elements that detail TLOs:
- api-call
- analysis-metadata
- binary-obfuscation
- capability
- dynamic-features
- field-data
- malware-development-environment
- name
- process-tree-node
- relationship-distance
- signature-metadata
- static-features

```ad-example
![[MW236.png]]

```

#### MAEC VOCABULARIES
![[MW237.png]]
## USE CASE: HOST BASED DETECTION
![[MW238.png]]


```ad-example
title: REAL WORLD EXAMPLE: MAEC & ZEUS BOT

![[MW239.png]]
```

## USE CASE: DATA FUSION & CORRELATION
![[MW240.png]]

## MAEC & STIX
![[MW241.png]]

## EMBEDDING MAEC IN STIX
By embedding native MAEC data in a STIX document, detailed, structured information about one or more malware samples can be captured alongside broader cyber threat information.

![[MW242.png]]

## EMBEDDING MAEC IN STIX
![[MW243.png]]
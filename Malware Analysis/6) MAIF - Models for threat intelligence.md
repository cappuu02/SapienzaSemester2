
# Models for threat Intelligence
```ad-question
title: What we are looking for?
Most dangerous attacks are today characterized by:
- Precise targeting 
- Use of advanced intrusion/obfuscation techniques 
- Full control of target (RAT) 
- Long-term persistence (APT)

The attacker (threat) has enough motivations/resources/skills to try to attack its target for prolonged periods of time, using several approaches. 
```
# Cyber Threat Intelligence
**_Noise_**: Is composed of everything that is collected according to priority intelligence requirements (PIR).
**_Data_**: Noise is filtered-out. Remaining artifacts are grouped according to defining characteristics.
**_Information_**: Data with a purpose. (Data with purpose = information)
**_Intelligence_**: Information with a strategic purpose that can be used to gain advantage. (exclusively a human centered activity)
**_Actionable intelligence_**: significa **informazioni utili su cui puoi agire subito**.

An effective ==threat intelligence== process has the **_main purpose_** of characterizing threats in order to identify valuable preventative controls.

![[MW70.png]]

==Goals== at several levels:
**_Executives in the strategic levels_**: Provide understanding of identified and credible threats, correlated to business impact.
**_Managers & Analysts in tactical levels_**: Enable formulation of approaches to dealing with threats and prioritization of team activity.
**_Security Operators in Operational levels_**: Provide understanding of how to mitigate threats and enable tools to do the heavy lifting.

```ad-question
title: How do we make intelligence “actionable”?
```

We assume the attack is resource constrained and behaves like a rational human being. 
**Cost factors**:
- Expertise (competenza)
- Time
- Money
- Resources

**Success Factor**:
- Target ubiquity
- Probability
- Access

==Value for the attacker== comes from the **_possibility of re-using attack methodologies, techniques, tools as much as possible_**. In this case we have:
- **_Repeatability_**: the capability to change the target and have the attack still work with the same success rate.
- **_Scalability_**: the capability to launch the attack against multiple targets with minimal cost per additional target.

Attackers determine the least costly and most valuable attacks based on:
- Who the targets are 
- Required success rate 
- Speed of conversion (Quanto rapidamente l’attaccante ricava valore dopo l’intrusione)

```ad-example
![[MW71.png]]

```

# Intrusion Kill Chain
The kill chain is not just a way to represent attacks, but rather a methodology to analyse (tentatives of) intrusions to extract actionable information (intelligence).

## Indicators
The fundamental element of intelligence in this model is the **_indicator_**.

```ad-abstract
title: Indicator Definition
è **qualsiasi informazione che descrive oggettivamente un’intrusione** o un comportamento malevolo nel sistema.

➡️ In pratica, è un dato che segnala che qualcosa di sospetto o dannoso è avvenuto o sta avvenendo.

```

Three types of indicators:
- **_Atomic_** - those which cannot be broken down into smaller parts and retain their meaning in the context of an intrusion. (e.g. IP addresses, email addresses, vulnerability identifiers, etc.) 
- **_Computed_** - those which are derived from data involved in an incident. (e.g. hash values) 
- **_Behavioral_** - They describe a behavior or sequence of actions observed in an attack. They combine multiple indicators (atomic + computed). (e.g. “the intruder initially used a backdoor which generated network traffic matching `[regular expression]` at the rate of `[some frequency]` to `[some IP address]`”).


==Indicators Life Cycle==
![[MW72.png|500]]
1. **_Revealed_**: Indicatore scoperto/rilevato, si fa un report per documentarlo
2. **_Mature_**: L'indicatore viene verificato, certificato e contestualizzato (capire quanto è affidabile)
3. **_Utilized_**: L'indicatore viene utilizzato nei sistemi di difesa e può generare nuove scoperte riportando il ciclo al punto iniziale.

>Indicators can be used to describe/identify various stages of the intrusion using the kill chain as a reference model.

```ad-example
![[MW73.png|500]]

```


## Course of Action
The intrusion kill chain becomes a model for actionable intelligence when defenders align enterprise defensive capabilities to the specific processes an adversary undertakes to target that enterprise.

![[MW74.png]]

==Strategies== to **counteract intrusions**: 
- **_Detect_**: set up detection rules of an indicator for future events. (e.g. rules in an intrusion detection system (IDS), firewall or alert on SIEM) 
- **_Deny_**: prevent the event from taking place. (e.g. firewall block) 
- **_Disrupt_**: make the event fail as it is occurring. (e.g. file quarantining or memory protection measures) 
- **_Degrade_**: slow down the further actions of the attacker. (e.g. bandwidth throttling) 
- **_Deceive_**: learn more about the intentions of the attacker by making them think the action was successful. (e.g. use an honeypot) 
- **_Destroy_**: offensive action against the attacker. (think twice about it…) 

Measure effectiveness to drive defense strategies over time!
![[MW75.png]]
- **_Detection_**: minaccia individuata, ma non ancora fermata.
- **_Mitigation_**: minaccia viene contenuta o bloccata.
- $\rightarrow$: le info raccolte in una fase vengono usate per migliorare la difesa nelle fasi successive.

```ad-info
title: Explaination

La tabella mostra come, grazie all’uso di nuovi **indicatori di compromissione (IoC)**, un’organizzazione può **migliorare progressivamente la propria capacità di rilevare e mitigare attacchi** lungo le fasi della **Cyber Kill Chain**.  
Nel tempo (da dicembre a giugno), la difesa passa dal riconoscere solo le fasi finali dell’attacco al **bloccarlo già nelle fasi iniziali**, dimostrando un processo di maturazione della threat intelligence.
```

## Reconstruct the Kill Chain
Questa illustrazione mostra **come cambia la difesa** a seconda del **momento in cui viene rilevato l’attacco**.
![[MW76.png]]

```ad-info
title: Explaination
Il diagramma confronta la **rilevazione tardiva** con la **rilevazione precoce** di un attacco.  
Quando la minaccia viene individuata tardi, i danni sono già avvenuti; quando invece si riesce a **intercettare l’attacco nelle prime fasi**, è possibile **interrompere la catena** e prevenire l’intrusione.  
L’obiettivo è quindi **spostare la detection verso le fasi iniziali**, migliorando costantemente grazie all’analisi degli indicatori raccolti.

```

## Investigate Campaigns
Recurring attacks from persistent threats (**_APT_**) require deeper understandings. 
Compare intrusion indicators (**_IoC_**) to find **_inflection points_** (punti in comune), similar patterns, techniques, or infrastructures — that reveal a consistent operating model. 

![[MW77.png]]

Inflection points among diverse intrusions may represent common patterns in a long-term campaign. Such patterns can be used to uniquely identify threat actors.

![[MW78.png]]

## CKC Usage Scenarios
```ad-abstract
Caso di studio reale, che illustra in modo eccellente la **catena di kill cybernetico (CKC)** applicata a un famoso incidente di sicurezza: il **data breach di Target del 2013**.

```
Assess completeness of controls & countermeasures.

Post-mortem analysis...
![[MW79.png]]

…and lessons learned
![[MW80.png]]

## The Pyramid of Pain
Types of indicators:
- **_Hash Values_**: SHA1, MD5 or other similar hashes that correspond to specific suspicious or malicious files. Often used to provide unique references to specific samples of malware or to files involved in an intrusion. 
- **_IP Addresses_**: IP address or netblocks referring to the attacker. 
- **_Domain Names_**: this could be either a domain name itself (e.g., "evil.net") or maybe even a sub- or sub-sub-domain (e.g., "this.is.sooooo.evil.net") 
- **_Network Artifacts_**: observables caused by adversary activities on your network. In practice this really means those pieces of the activity that might tend to distinguish malicious activity from that of legitimate users. Typical examples might be URI patterns, C2 information embedded in network protocols, distinctive HTTP User-Agent or SMTP Mailer values, etc. 
- **_Host Artifacts_**: observables caused by adversary activities on one or more of your hosts. They could be registry keys or values known to be created by specific pieces of malware, files or directories dropped in certain places or using certain names, names or descriptions or malicious services… 
- **_Tools_**: software used by the adversary to accomplish their mission. Mostly this will be things they bring with them, rather than software or commands that may already be installed on the computer. 
- **_Tactics, Techniques and Procedures (TTPs)_**: how the adversary goes about accomplishing their mission, from reconnaissance all the way through data exfiltration and at every step in between. "Dumping cached authentication credentials and reusing them in Pass-the-Hash attacks" would be a TTP. 

![[MW81.png]]

==Limits==
A tool that is not perfectly suited to all uses:
-  User centric 
- Low-level description of observables (events) 
- Too focused on malware-based attacks 
- Several variants 
- Attackers do not always follow a playbook 

## The Diamond Model 
```ad-abstract
title: Definition
Il ==Diamond Model of Intrusion Analysis== è un modello concettuale usato nell’analisi delle minacce informatiche per **collegare tra loro indicatori, eventi e attori** e ottenere una visione completa di una campagna di attacco.

```

>Guida strutturata per passare dai dati tecnici (indicators) ai fatti strategici (chi attacca e perché).

Obiettivi del modello:
- **Descrive gli eventi di sicurezza** (incidenti o intrusioni) attraverso alcuni **aspetti fondamentali**.
- **Collega più eventi** appartenenti alla stessa intrusione tramite **activity threads** (fili logici che mostrano la sequenza delle azioni dell’attaccante).
- **Individua somiglianze** tra più activity threads (chiamate **inflection points**) per creare **activity groups**, cioè gruppi di attività riconducibili allo stesso **threat actor**.

Ogni **evento di intrusione** è rappresentato come un **diamante** con quattro elementi principali ai vertici:

| Vertice            | Descrizione                                                                       |
| ------------------ | --------------------------------------------------------------------------------- |
| **Adversary**      | L’attaccante o gruppo che esegue l’azione (persona, gruppo APT, criminale).       |
| **Capability**     | Gli strumenti, exploit o malware che usa per condurre l’attacco.                  |
| **Infrastructure** | I mezzi tecnici attraverso cui agisce (server, domini, botnet, e-mail, C2, ecc.). |
| **Victim**         | L’obiettivo dell’attacco (organizzazione, sistema, individuo).                    |


```ad-important
Per ogni evento di intrusione esiste un _adversary_ che compie un’azione verso un obiettivo, usando una _capability_ attraverso un’_infrastructure_, contro una _victim_, per ottenere un _risultato_.

```

Oltre ai 4 vertici principali, ci sono anche **meta-feature**, cioè informazioni aggiuntive che descrivono il **contesto**:
- **Time** → quando avviene l’attacco;
- **Phase** → in quale fase della kill chain si colloca;
- **Result** → che esito ha avuto l’attacco; (qualitative, informative, details)
- **Direction** $\to$ describes qualitatively the main direction for actions in the event 
- **Methodology** $\to$ description of the general class of activity 
- **External resources** → eventuali risorse aggiuntive usate dall’attaccante.

>Meta features can be expanded

Elements can be further break down to detail them:
![[MW82.png]]
![[MW83.png]]

==ADVERSARY==: actor/organization responsible for utilizing a capability against the victim to achieve their intent. 
- **_Adversary Operator_** - the actual “hacker” or person(s) conducting the intrusion activity. 
- **_Adversary Customer_** - the entity that stands to benefit from the activity conducted in the intrusion. It may be the same as the adversary operator, or it may be a separate person or group. 

==CAPABILITY==: tools and/or techniques of the adversary used in the event 
- **_Capability Capacity_** - all of the vulnerabilities and exposures that can be utilised by the individual capability regardless of victim are considered its capacity. 
- **_Adversary Arsenal_** - the adversary’s complete set of capabilities, and therefore the combined capacities of their individual capabilities. 

>The C&C typically represent a specific kind of capability used by the adversary

==INFRASTRUCTURE==: describes the physical and/or logical communication structures the adversary uses to deliver a capability, maintain control of capabilities and effect results from the victim.
- **Directly controlled** infrastructure 
- Infrastructure controlled by an **intermediary** 
- **Public infrastructure** providers

==VICTIM==: target of the adversary and against whom vulnerabilities and exposures are exploited and capabilities used. 
- **Persona**: and individual or organization being targeted 
- **Asset**: the attack surface and consist of the set of networks, systems, hosts, email addresses, IP addresses, social networking accounts, etc. against which the adversary directs their capabilities. 

The set of vulnerabilities and exposures of a victim susceptible to exploitation is referred to as the victim susceptibilities 
- They are sub-features of the victim 


Two useful feature extensions: 
- ==SOCIAL-POLITICAL==: Describes the relationship existing between the Adversary and its Victims 
	- Intent 
	- Persistence 
	- Useful to defined a shared threat-space with other victims 
- ==TECHNOLOGY==: Describes the technology connecting and enabling the infrastructure and the capability to operate and communicate.

![[MW84.png]]


## Analytical Pivoting
![[MW85.png]]

Different approaches: 
- **_Victim-centered_**: analyzing data related to a potential victim reveals the other related (and Diamond-connected) elements: malicious capabilities and infrastructure. 
- **_Capability-centered_**: exploits features of a capability to discover those other related elements like (i) victims whom that capability is used against, (ii) infrastructure supporting the capability, (iii) technology enabling the capability, (iv) clues to other related capabilities, (v) and (possible) clues to the adversary. 
- **_Infrastructure-centered_**: focuses on the malicious infrastructure of the adversary. From this element other related elements can be discovered. Difficult access. 
- **_Adversary-centered_**: mostly reserved to law-enforcement agencies.

## Activity Thread 
La tabella mostra tre diversi **Activity Thread** (Fili di Attività), ognuno dei quali rappresenta un attacco completo contro una vittima diversa (Victim₁, Victim₂, Victim₃). Ogni cella della tabella contiene un "diamante" o un **evento** specifico, identificato da una lettera (A, B, C, etc.).

La genialità di questa visualizzazione sta nel mostrare come un avversario riutilizzi componenti (Adversary, Capability, Infrastructure) attraverso attacchi multipli.

![[MW86.png]]

```ad-info
title: Spiegazione Immagine
#### Thread 1 (Victim₁)

Questo è un attacco complesso e diversificato, che utilizza molte capability diverse.

- **Reconnaissance (A):** L'avversario raccoglie informazioni su Victim₁.
    
- **Weaponization (B):** Crea uno strumento di attacco specifico (es. un malware personalizzato).
    
- **Delivery (C):** Utilizza un'infrastruttura specifica (es. un server di phishing) per consegnare l'arma.
    
- **Exploitation (H):** Qui avviene un cambio interessante. Per sfruttare la vittima, usa una capability (H) che **viene riutilizzata anche nella fase C2 dell'attacco a Victim₂**. Questo è un **forte inflection point**.
    
- **Installation (E):** Installa un payload (es. una backdoor) sulla vittima.
    
- **C2 (G):** Stabilisce un canale di comando e controllo.
    
- **Action on Objectives (T):** Porta a termine il suo obiettivo finale (es. ruba dati).
  
  
#### Thread 2 (Victim₂)

Qui vediamo un riutilizzo massiccio di capability, indicando una "firma" operativa dell'avversario.

- **Reconnaissance (B):** Non inizia dalla ricognizione, ma riutilizza la capability di weaponization usata per Victim₁. Questo è insolito e potrebbe indicare che la fase di ricognizione per Victim₂ era già completata o che l'arma (B) conteneva anche componenti di ricognizione.
    
- **Weaponization (J):** Crea una nuova arma specifica per questa vittima.
    
- **Delivery (D):** Riutilizza la stessa infrastruttura di delivery usata in un'altra fase per Victim₁.
    
- **Exploitation (K):** Utilizza un nuovo exploit.
    
- **Installation (F):** Riutilizza la stessa tecnica di installation usata per Victim₁.
    
- **C2 (H):** **Questo è l'inflection point chiave.** Riutilizza la stessa capability (H) per il C2 che è stata usata per lo sfruttamento (Exploitation) di Victim₁. Questo è estremamente significativo per collegare gli attacchi.
    
- **Action on Objectives (I):** Completamento dell'attacco.
    

#### Thread 3 (Victim₃)

Questo attacco è più lineare e sembra utilizzare capability dedicate, ma condivide comunque punti cruciali.

- **Reconnaissance (C):** Riutilizza la stessa infrastruttura/informazione usata per consegnare il payload a Victim₁.
    
- **Weaponization (M):** Nuova capability.
    
- **Delivery (N):** La stessa capability (N) è usata sia per la Delivery che per la Exploitation, il che è molto comune (es. un documento di phishing che sfrutta una vulnerabilità per eseguire codice).
    
- **Exploitation (N):** Stessa capability della fase di Delivery.
    
- **Installation (O):** La stessa capability (O) è usata sia per l'installazione che per il C2. Anche questo è comune (es. il payload installato ha già integrato il canale C2).
    
- **C2 (O):** Stessa capability della fase di Installation.
    
- **Action on Objectives (V):** Completamento dell'attacco.

```


**_Vertical correlation_**: l'analisi in profondità di un singolo **Activity Thread** che mira a ricostruire l'intera storia dell'intrusione su una singola vittima.
- Identify knowledge gaps (non sapere com l'attaccante passa da una fase $B$ ad una fase $C$)
- Fill those gaps with new knowledge 
- Establish causal relationships among events 

**_Horizontal correlation_**: è il processo di collegare _diversi_ Activity Thread per identificare una campagna più ampia. È qui che si scopre l'**Activity Group**.
- The analytic process of causally linking events between vertical threads across adversary-victim pairs (Noti che la `Capability H` è stata usata in `Exploitation` su Victim₁ e in `C2` su Victim₂. Questo è un collegamento causale orizzontale.)
- identify common knowledge gaps between threads 
- use knowledge from one thread to fill knowledge gap in another 
- Identify common features across victims which can lead to the creation of an activity group 

Identify Adversary processes 
- Remove the details 
- Focus on common recurring elements 
- Check among known activity threads

![[MW87.png]]


Support for analytical hypothesis checking 
- Support through other approaches 
- E.g. Attack graphs

![[MW88.png]]
## Activity Groups
Extract knowledge related to activity groups through a process: 
- **_Step 1: Analytic Problem_** The particular analytic problem to be solved through grouping 
- **_Step 2: Feature Selection_** The event features and adversary processes used to form the basis of classification and clustering are selected 
- **_Step 3: Creation_** Activity groups are created from the set of events and threads
- **_Step 4: Growth_** As new events flow into the model, they are classified into the Activity Groups 
- **_Step 5: Analysis_** Activity groups are analyzed to address the analytic problem(s) defined 
- **_Step 6: Redefinition_** Activity groups need to be redefined from time-to-time to maintain their accuracy 

![[MW89.png]]\
![[MW90.png]]


# Models for threat Intelligence
```ad-question
title: What we are looking for?
Most dangerous attacks are today characterized by:
- Precise targeting 
- Use of advanced intrusion/obfuscation techniques 
- Full control of target (RAT) 
- Long-term persistence (APT)

The attacker (threat) has enough motivations/resources/skills to try to attack its target for prolonged periods of time, using several approaches. 
```
# Cyber Threat Intelligence
**_Noise_**: Is composed of everything that is collected according to priority intelligence requirements (PIR).
**_Data_**: Noise is filtered-out. Remaining artifacts are grouped according to defining characteristics.
**_Information_**: Data with a purpose. (Data with purpose = information)
**_Intelligence_**: Information with a strategic purpose that can be used to gain advantage. (exclusively a human centered activity)
**_Actionable intelligence_**: significa **informazioni utili su cui puoi agire subito**.

An effective ==threat intelligence== process has the **_main purpose_** of characterizing threats in order to identify valuable preventative controls.

![[MW70.png]]

==Goals== at several levels:
**_Executives in the strategic levels_**: Provide understanding of identified and credible threats, correlated to business impact.
**_Managers & Analysts in tactical levels_**: Enable formulation of approaches to dealing with threats and prioritization of team activity.
**_Security Operators in Operational levels_**: Provide understanding of how to mitigate threats and enable tools to do the heavy lifting.

```ad-question
title: How do we make intelligence “actionable”?
```

We assume the attack is resource constrained and behaves like a rational human being. 
**Cost factors**:
- Expertise (competenza)
- Time
- Money
- Resources

**Success Factor**:
- Target ubiquity
- Probability
- Access

Value for the attacker comes from the possibility of re-using attack methodologies, techniques, tools as much as possible. In this case we have:
- **_Repeatability_**: the capability to change the target and have the attack still work with the same success rate.
- **_Scalability_**: the capability to launch the attack against multiple targets with minimal cost per additional target.

Attackers determine the least costly and most valuable attacks based on:
- Who the targets are 
- Required success rate 
- Speed of conversion (Quanto rapidamente l’attaccante ricava valore dopo l’intrusione)

```ad-example
![[MW71.png]]

```

# Intrusion Kill Chain
The kill chain is not just a way to represent attacks, but rather a methodology to analyse (tentatives of) intrusions to extract actionable information (intelligence).

## Indicators
The fundamental element of intelligence in this model is the **_indicator_**.

```ad-abstract
title: Indicator Definition
Any piece of information that objectively describes an intrusion

```

Three types of indicators:
- **_Atomic_** - those which cannot be broken down into smaller parts and retain their meaning in the context of an intrusion. (e.g. IP addresses, email addresses, vulnerability identifiers, etc.) 
- **_Computed_** - those which are derived from data involved in an incident. (e.g. hash values) 
- **_Behavioral_** - collections of computed and atomic indicators, often subject to qualification by quantity and possibly combinatorial logic. (e.g. “the intruder initially used a backdoor which generated network traffic matching `[regular expression]` at the rate of `[some frequency]` to `[some IP address]`”).

![[MW72.png|500]]

Indicators can be used to describe/identify various stages of the intrusion using the kill chain as a reference model.

![[MW73.png|500]]

## Course of Action
The intrusion kill chain becomes a model for actionable intelligence when defenders align enterprise defensive capabilities to the specific processes an adversary undertakes to target that enterprise.

![[MW74.png]]

==Strategies== to **counteract intrusions**: 
- **_Detect_**: set up detection rules of an indicator for future events. (e.g. rules in an intrusion detection system (IDS), firewall or alert on SIEM) 
- **_Deny_**: prevent the event from taking place. (e.g. firewall block) 
- **_Disrupt_**: make the event fail as it is occurring. (e.g. file quarantining or memory protection measures) 
- **_Degrade_**: slow down the further actions of the attacker. (e.g. bandwidth throttling) 
- **_Deceive_**: learn more about the intentions of the attacker by making them think the action was successful. (e.g. use an honeypot) 
- **_Destroy_**: offensive action against the attacker. (think twice about it…) 

Measure effectiveness to drive defense strategies over time!
![[MW75.png]]

## Reconstruct the Kill Chain
Improved protection affects the course of actions:
![[MW76.png]]


## Investigate Campaigns
Recurring attacks from persistent threats require deeper understandings. 
Compare intrusion indicators to find commonalities.

![[MW77.png]]

Inflection points among diverse intrusions may represent common patterns in a long-term campaign Such patterns can be used to uniquely identify threat actors.

![[MW78.png]]

## CKC Usage Scenarios
Assess completeness of controls & countermeasures.

Post-mortem analysis...
![[MW79.png]]

…and lessons learned
![[MW80.png]]

## The Pyramid of Pain
Types of indicators:
- **_Hash Values_**: SHA1, MD5 or other similar hashes that correspond to specific suspicious or malicious files. Often used to provide unique references to specific samples of malware or to files involved in an intrusion. 
- **_IP Addresses_**: IP address or netblocks referring to the attacker. 
- **_Domain Names_**: this could be either a domain name itself (e.g., "evil.net") or maybe even a sub- or sub-sub-domain (e.g., "this.is.sooooo.evil.net") 
- **_Network Artifacts_**: observables caused by adversary activities on your network. In practice this really means those pieces of the activity that might tend to distinguish malicious activity from that of legitimate users. Typical examples might be URI patterns, C2 information embedded in network protocols, distinctive HTTP User-Agent or SMTP Mailer values, etc. 
- **_Host Artifacts_**: observables caused by adversary activities on one or more of your hosts. They could be registry keys or values known to be created by specific pieces of malware, files or directories dropped in certain places or using certain names, names or descriptions or malicious services… 
- **_Tools_**: software used by the adversary to accomplish their mission. Mostly this will be things they bring with them, rather than software or commands that may already be installed on the computer. 
- **_Tactics, Techniques and Procedures (TTPs)_**: how the adversary goes about accomplishing their mission, from reconnaissance all the way through data exfiltration and at every step in between. "Dumping cached authentication credentials and reusing them in Pass-the-Hash attacks" would be a TTP. 

![[MW81.png]]

==Limits==
A tool that is not perfectly suited to all uses:
-  User centric 
- Low-level description of observables (events) 
- Too focussed on malware-based attacks 
- Several variants 
- Attackers do not always follow a playbook 

## The Diamond Model 
This model guides the analysis process through several predefined steps that starting from indicators, strive to identify high-level facts about the security incidents that are analysed:
- Describes security **_events_** (incidents) through few basic aspects 
- Connects events that took place in a single intrusion through **_activity threads_** 
- Identifies commonalities among activity threads forming **_activity groups_** that can then be used for strategic planning

The model represent “events” (intrusion) as a set of core features pertaining to few fundamental aspects.

```ad-important
For every intrusion event there exists an adversary taking a step towards an intended goal by using a capability over infrastructure against a victim to produce a result.

```

An event defines discrete time-bound activity restricted to a specific phase The adversary may require access to further external resources to reach its goal (meta features).
Elements can be further break down to detail them:

![[MW82.png]]
![[MW83.png]]

==ADVERSARY==: actor/organisation responsible for utilising a capability against the victim to achieve their intent. 
- **_Adversary Operator_** - the actual “hacker” or person(s) conducting the intrusion activity. 
- **_Adversary Customer_** - the entity that stands to benefit from the activity conducted in the intrusion. It may be the same as the adversary operator, or it may be a separate person or group. 

==CAPABILITY==: tools and/or techniques of the adversary used in the event 
- Capability Capacity - all of the vulnerabilities and exposures that can be utilised by the individual capability regardless of victim are considered its capacity. 
- Adversary Arsenal - the adversary’s complete set of capabilities, and therefore the combined capacities of their individual capabilities. 
The C&C typically represent a specific kind of capability used by the adversary

==INFRASTRUCTURE==: describes the physical and/or logical communication structures the adversary uses to deliver a capability, maintain control of capabilities and effect results from the victim.
- **Directly controlled** infrastructure 
- Infrastructure controlled by an **intermediary** 
- **Public infrastructure** providers

==VICTIM==: target of the adversary and against whom vulnerabilities and exposures are exploited and capabilities used. 
- Persona: and individual or organization being targeted 
- Asset: the attack surface and consist of the set of networks, systems, hosts, email addresses, IP addresses, social networking accounts, etc. against which the adversary directs their capabilities. 
The set of vulnerabilities and exposures of a victim susceptible to exploitation is referred to as the victim susceptibilities 
- They are sub-features of the victim 

==META FEATURES== 
- Timestamp: date and/or time when the event occurred. May include start/end timestamps 
- Phase: represents the specific logical role played by the event in an activity thread 
	- You may want to stick with the cyber kill chain jargon for phases 
- Results: post-conditions of an adversary’s operations 
	- Qualitative: <Success,Failure,Unknown> 
	- Informative: Confidentiality | Integrity | Availability-compromised 
	- Details: refer to the specific compromised assets 
- Direction: describes qualitatively the main direction for actions in the event 
	- Victim-to-Infrastructure, Infrastructure-to-Victim, Infrastructure-to-Infrastructure, Adversary-to- Infrastructure, Infrastructure-to-Adversary, Bidirectional, or Unknown 
- Methodology: description of the general class of activity 
	- E.g.: spear-phish email, content-delivery attack, syn flood, etc. 
	- Better use an existing taxonomy 
- Resources: all supporting elements on which the event, and therefore each core- and meta-feature, depends 
	- E.g.: software, knowledge, information, hardware, funds, facilities, access

>Meta features can be expanded


Two useful feature extensions: 
- ==SOCIAL-POLITICAL==: Describes the relationship existing between the Adversary and its Victims 
	- Intent 
	- Persistence 
	- Useful to defined a shared threat-space with other victims 
- ==TECHNOLOGY==: Describes the technology connecting and enabling the infrastructure and the capability to operate and communicate.

![[MW84.png]]


## Analytical Pivoting
![[MW85.png]]

Different approaches: 
- **_Victim-centered_**: analyzing data related to a potential victim reveals the other related (and Diamond-connected) elements: malicious capabilities and infrastructure. 
- **_Capability-centered_**: exploits features of a capability to discover those other related elements like (i) victims whom that capability is used against, (ii) infrastructure supporting the capability, (iii) technology enabling the capability, (iv) clues to other related capabilities, (v) and (possible) clues to the adversary. 
- **_Infrastructure-centered_**: focuses on the malicious infrastructure of the adversary. From this element other related elements can be discovered. Difficult access. 
- **_Adversary-centered_**: mostly reserved to law-enforcement agencies.

## Activity Thread 
![[MW86.png]]

**_Vertical correlation_**
- Identify knowledge gaps 
- Fill those gaps with new knowledge 
- Establish causal relationships among events 

**_Horizontal correlation _**
- The analytic process of causally linking events between vertical threads across adversary-victim pairs 
- identify common knowledge gaps between threads 
- use knowledge from one thread to fill knowledge gap in another 
- Identify common features across victims which can lead to the creation of an activity group 

Identify Adversary processes 
- Remove the details 
- Focus on common recurring elements 
- Check among known activity threads

![[MW87.png]]


Support for for analytical hypothesis checking 
- Support through other approaches 
- E.g. Attack graphs

![[MW88.png]]
## Activity Groups
Extract knowledge related to activity groups through a process: 
- **_Step 1: Analytic Problem_** The particular analytic problem to be solved through grouping 
- **_Step 2: Feature Selection_** The event features and adversary processes used to form the basis of classification and clustering are selected 
- **_Step 3: Creation_** Activity groups are created from the set of events and threads
- **_Step 4: Growth_** As new events flow into the model, they are classified into the Activity Groups 
- **_Step 5: Analysis_** Activity groups are analyzed to address the analytic problem(s) defined 
- **_Step 6: Redefinition_** Activity groups need to be redefined from time-to-time to maintain their accuracy 

![[MW89.png]]\
![[MW90.png]]
